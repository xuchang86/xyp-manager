/*!
 * 本地存储框架cStorgae v1.0
 * 地址：http://10.10.50.7/cStorage
 * 开发日期: 13-11-5
 *
 * 非开源
 * 版权: 康拓普技术研究中心 王伟
 *
 * 依赖:无
 * 全局变量：cStorage, cst;
 */
(function(f){var b=0,g=30,l=function(){},c=f.cst=f.cStorage={VERSION:"1.0-beta1",type:"none",support:true,use:null,info:l,destroy:l},d=f.localStorage,i="[object Storage]",h,e,j=f.document,k=f.JSON||{},a;b=Math.min(b,7);g=Math.min(g,60);if(typeof d==="object"){if(typeof d.toString==="function"){h=d.toString()}if(h!==i&&d.constructor){h=d.constructor.toString()}}if(h===i){c.type="storage"}else{if(j.documentElement.addBehavior){c.type="userData"}}e=c._tool={dA:b,mA:g,coreToString:Object.prototype.toString,storage:f.localStorage,initObj:function(m){delete m._data;delete m._info;m.set=m.remove=m.clear=function(){return this};m.get=m.count=function(){};return m},error:function(m){throw Error(m)},getStorageName:function(m){if(typeof m!=="string"||!/^\w+$/g.test(m)||m.length<8){this.error("storageId\u81F3\u5C11\u75318\u4F4D\u5B57\u6BCD\uFF0C\u6570\u5B57\u548C\u4E0B\u5212\u7EBF\u7EC4\u6210")}return"cs_"+m+"_"},filterName:function(m){if(typeof m!=="string"){this.error("\u53C2\u6570name\u5E94\u8BE5\u4E3A\u5B57\u7B26\u4E32")}},getExpiresDate:function(n){var m=new Date();m.setTime(m.getTime()+n*86400000);return m.toUTCString()},random:function(){return Math.random().toString().substring(2,10)-0},fixMaxAge:function(n){var m=typeof n;if(m==="number"){n=n<0?0:n;return Math.min(parseInt(n,10),this.mA)}},useManager:function(n,m){var p,o;o=this.mA;this.mA=360;p=c.use(n,m);this.mA=o;return p},stringifyJSON:k.stringify,parseJSON:k.parse};c._publicMethods={set:function(n,r){var s,q,o,m,t;e.updateData(this);q=this._data;if(typeof q==="object"){o=e.stringifyJSON;if(e.coreToString.call(n)==="[object Object]"){for(s in n){if(n.hasOwnProperty(s)){m=n[s];if(m===undefined){if(q[s]!==undefined){t=true;delete q[s]}}else{m=o(m);if(q[s]!==m){t=true;q[s]=m}}}}}else{e.filterName(n);if(r===undefined){if(r!==q[n]){t=true;delete q[n]}}else{r=o(r);if(r!==q[n]){t=true;q[n]=r}}}if(t){e.setData(this)}}return this},get:function(m){var o,n;e.updateData(this);e.filterName(m);o=this._data;if(typeof o==="object"){n=o[m];if(n!==undefined){return e.parseJSON(n)}}},count:function(){var o,n,m;e.updateData(this);n=this._data;if(typeof n==="object"){m=0;for(o in n){m++}return m}},remove:function(m){var n;e.updateData(this);e.filterName(m);n=this._data;if(typeof n==="object"&&n[m]!==undefined){delete n[m];e.setData(this)}return this},clear:function(){e.updateData(this);if(typeof this._data==="object"){this._data={};e.setData(this)}return this},setMaxAge:function(m){m=e.fixMaxAge(m);if(m!==undefined){e.updateData(this);if(this._info){this._info.a=m;e.setInfo(this)}}},getMaxAge:function(){e.updateData(this);if(this._info){return this._info.a}}};if(c.type!=="none"){a=/cs_cStorage_=1/;if(!a.test(j.cookie)){j.cookie="cs_cStorage_=1;path=/";c._firstLoad=true}}else{c.support=false;c.use=function(){return c._tool.initObj({})}}})(window);(function(f){var c=f.cStorage,b,g,a,e;if(c.type!=="storage"){return}b=c._tool;g=b.storage;a={};e="i";c.use=function(j,h){var i=b.getStorageName(j),k;if(a[i]){return a[i]}if(b.createCallBack){b.createCallBack(j)}k=b.getItem(i+e);if(k){a[i]=new d(i,undefined,false);return a[i]}a[i]=new d(i,b.fixMaxAge(h),true);return a[i]};c.exists=function(h){return !!this.info(h)};c.info=function(i){var h=b.getStorageName(i),j=b.getItem(h+e);if(j){return j}return null};c.destroy=function(i){var h=b.getStorageName(i),j=a[h];g.removeItem(h);g.removeItem(h+e);if(j){b.initObj(j);delete a[h]}};function d(j,h,i){var k=new Date().getTime();this._storageName=j;if(i){this._data={};this._info={d:k,a:h===undefined?b.dA:h};b.setData(this)}else{this._data=b.getItem(j)||{};this._info=b.getItem(j+e);this._info.d=k;b.setInfo(this)}}d.prototype=c._publicMethods;b.setData=function(i){try{g.setItem(i._storageName,this.stringifyJSON(i._data))}catch(h){}i._info.s=this.random();this.setInfo(i)};b.setInfo=function(h){g.setItem(h._storageName+e,this.stringifyJSON(h._info))};b.updateData=function(k){var i=k._storageName,j=k._info,h=b.getItem(i+e);if(!h){k._data=k._info=undefined}else{if(!j||j.s!==h.s){k._data=b.getItem(i)||{};k._info=h}}};b.getItem=function(i){var h;try{h=this.parseJSON(g.getItem(i))}catch(j){}return h}})(window);(function(tool){var f;if(typeof tool.stringifyJSON==="function"){return}f=function(n){return n<10?"0"+n:n};if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?[this.getUTCFullYear(),"-",f(this.getUTCMonth()+1),"-",f(this.getUTCDate()),"T",f(this.getUTCHours()),":",f(this.getUTCMinutes()),":",f(this.getUTCSeconds()),"Z"].join(""):null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep,quote=function(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'},str=function(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}};tool.stringifyJSON=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})};tool.parseJSON=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}this.error("JSON.parse")}})(window.cStorage._tool);(function(e){var i=e.document,a,c=e.cStorage,f,g,b,d;if(c.type!=="userData"){return}f=c._tool;g={};(function(){var j,n,m,l,k;j=i.getElementsByTagName("script");for(l=j.length;l--;){n=j[l].getAttribute("src");if(n){n=/^(.*?)cStorage(\.full)?\.min\.js/.exec(n);if(n){m=n[1];break}}}if(m===undefined){f.error("\u9700\u540D\u4E3AcStorage.full.min.js\u7684\u6587\u4EF6")}k=i.createElement("iframe");k.src=m+"carrier.html";k.style.display="none";if(i.body){i.body.appendChild(k)}else{i.getElementsByTagName("head")[0].appendChild(k)}a=k.contentWindow.document})();d=function(j){var k=a.createElement("div");k.innerHTML=j;if(a.body){a.body.appendChild(k)}else{a.appendChild(k)}k.addBehavior("#default#userData");return k};b=d("null");c.use=function(m,k){var l=f.getStorageName(m),j;if(g[l]){return g[l]}if(f.createCallBack){f.createCallBack(m)}j=d(l);j.load(l);if(f.getItem(j,"info")){g[l]=new h(j,l,undefined,false);return g[l]}g[l]=new h(j,l,f.fixMaxAge(k),true);return g[l]};c.exists=function(j){return !!this.info(j)};c.info=function(k){var j=f.getStorageName(k),l;b.load(j);l=f.getItem(b,"info");if(l){return l}return null};c.destroy=function(k){var j=f.getStorageName(k),m=g[j],l;if(m){l=m._instantial;l.expires=f.getExpiresDate(-99);l.save(j);l.parentNode.removeChild(l);f.initObj(m);delete g[j]}else{b.load(j);b.expires=f.getExpiresDate(-99);b.save(j)}};function h(k,o,m,n){var p=new Date().getTime(),l=f.dA,j=m===undefined?l:m;this._storageName=o;this._instantial=k;if(n){this._data={};this._info={d:p,a:j};f.setData(this)}else{this._data=f.getItem(k,"data")||{};this._info=f.getItem(k,"info");this._info.d=p;f.setInfo(this)}}h.prototype=c._publicMethods;f.setData=function(k){try{k._instantial.setAttribute("data",f.stringifyJSON(k._data).replace(/\\"/g,"\u0081").replace(/"/g,"\u0080"))}catch(j){}k._info.s=this.random();this.setInfo(k)};f.setInfo=function(m){var j=m._instantial,l=m._info;try{j.setAttribute("info",f.stringifyJSON(l).replace(/\\"/g,"\u0081").replace(/"/g,"\u0080"));j.expires=f.getExpiresDate(l.a||1);j.save(m._storageName)}catch(k){}};f.updateData=function(m){var j=m._instantial,l=m._info,k;j.load(m._storageName);k=this.getItem(j,"info");if(!k){m._data=m._info=undefined}else{if(!l||l.s!==k.s){m._info=k;m._data=this.getItem(j,"data")||{}}}};f.getItem=function(j,l){var k;try{k=f.parseJSON(j.getAttribute(l).replace(/\u0081/g,'\\"').replace(/\u0080/g,'"'))}catch(m){}return k}})(window);(function(c){var b,h,g,d,a,i,e,f;if(!c.support){return}g=c._tool;b=g.useManager("_cStorageCookieManager",90);d=b._data;if(c._firstLoad){c.destroy("_cStorageSessionManager");e=new Date().getTime();for(a in d){i=g.parseJSON(d[a]);if(i&&i[1]&&i[1]<e){delete d[a]}}g.setData(b)}h=g.useManager("_cStorageSessionManager",90);f=function(j){b.remove(j);h.remove(j)};c.cookie={set:function(l,n,j){var m,k;g.filterName(l);if(n===undefined){f(l);return this}if(j===undefined){b.remove(l);h.set(l,n);return this}m=g.coreToString.call(j).slice(8,-1);k=new Date().getTime();if(m==="Number"){if(j<=0){f(l)}else{h.remove(l);b.set(l,[n,k+j])}}else{if(m==="Date"){j=j.getTime();if(j<=k){f(l)}else{h.remove(l);b.set(l,[n,j])}}else{g.error("\u53C2\u6570expires\u9519\u8BEF")}}return this},get:function(j){var k;g.filterName(j);k=b.get(j);if(k){if(k[1]&&k[1]<new Date().getTime()){b.remove(j);return}return k[0]}else{return h.get(j)}},remove:function(j){g.filterName(j);f(j);return this}}})(window.cStorage);(function(g){var c=g.cStorage,b,a,d,h,f,e;if(!c.support){return}if(c._firstLoad){d=c._tool.useManager("_cStorageCreateManager");h=d.get("nameList");b=new Date().getTime();if(typeof h==="object"){for(f in h){e=c.info(f);if(!e||e.a===0||b>e.d+e.a*86400000){c.destroy(f);delete h[f]}}d.set("nameList",h)}else{if(c.type==="storage"){a=g.localStorage;for(f in a){f=/^cs_(\w{8,})_$/.exec(f);if(f){f=f[1];e=c.info(f);if(!e||e.a===0||b>e.d+e.a*86400000){c.destroy(f)}}}}}}})(window);(function(c){var a=c.cStorage,b,d;if(!a.support){return}b=a._tool.useManager("_cStorageCreateManager",90);a._tool.createCallBack=function(e){d=b.get("nameList")||{};if(!d[e]){d[e]=1;b.set("nameList",d)}}})(window);